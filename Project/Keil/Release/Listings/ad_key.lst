C51 COMPILER V9.60.7.0   AD_KEY                                                            05/21/2025 18:01:23 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE AD_KEY
OBJECT MODULE PLACED IN .\Release\Objects\ad_key.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\ad_key.c LARGE OPTIMIZE(9,SIZE) BROWSE INTVECTOR(0X000C) INCD
                    -IR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\List
                    -ings\ad_key.lst) OBJECT(.\Release\Objects\ad_key.obj)

line level    source

   1          #include "ad_key.h"
   2          
   3          extern u8 ad_key_get_key_id(void);
   4          
   5          // è‡ªå®šä¹‰adæŒ‰é”®çš„é”®å€¼:
   6          enum
   7          {
   8              AD_KEY_ID_ONE_LEFT = 0x01,
   9              AD_KEY_ID_TWO_LEFT,
  10              AD_KEY_ID_THREE_LEFT,
  11              AD_KEY_ID_ONE_RIGHT,
  12              AD_KEY_ID_TWO_RIGHT,
  13              AD_KEY_ID_THREE_RIGHT,
  14          };
  15          
  16          // å®šä¹‰æŒ‰é”®æ‰«æå‡½æ•°ä¸­ï¼Œå„ä¸ªæ‰«æçŠ¶æ€ï¼š
  17          // enum
  18          // {
  19          //     AD_KEY_SCAN_STATUS_NONE,                  // ç©ºçŠ¶æ€ï¼Œæ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹
  20          //     AD_KEY_SCAN_STATUS_IS_DETECT_LOOG_PRESS,  // æ­£åœ¨æ£€æµ‹æ˜¯å¦ä¸ºé•¿æŒ‰ï¼ˆè¦è·Ÿæ£€æµ‹é•¿æŒ‰ä½œåŒº
             -åˆ†ï¼‰
  21          //     AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰
  22          //     AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰æŒç»­ï¼ˆä¸æ¾æ‰‹ï¼‰
  23          //     AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS, // æ­£åœ¨å¤„ç†çŸ­æŒ‰
  24          
  25          //     AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE, // æ­£åœ¨ç­‰å¾…çŸ­æŒ‰æ¾å¼€
  26          //     AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE,  // æ­£åœ¨ç­‰å¾…é•¿æŒ‰æ¾å¼€
  27          //     AD_KEY_SCAN_STATUS_IS_END,                      // æ”¶å°¾å¤„ç†
  28          // };
  29          // static volatile u8 ad_key_scan_status = 0; // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°ä¸­ï¼Œä½¿ç”¨çš„çŠ¶æ€æœº
  30          
  31          // å­˜æ”¾æŒ‰é”®å¯¹åº”çš„adå€¼:
  32          static const u16 ad_key_scan_table[][2] = {
  33              // [][0]æŒ‰é”®å¯¹åº”çš„æ ‡å·,åœ¨åˆ¤æ–­æŒ‰é”®é”®å€¼æ—¶ä½¿ç”¨   [][1]æŒ‰é”®å¯¹åº”çš„adå€¼
  34              // {AD_KEY_ID_ONE_LEFT, AD_KEY_ONE_LEFT_VAL},
  35              // {AD_KEY_ID_TWO_LEFT, AD_KEY_TWO_LEFT_VAL},
  36              // {AD_KEY_ID_THREE_LEFT, AD_KEY_THREE_LEFT_VAL},
  37              // {AD_KEY_ID_ONE_RIGHT, AD_KEY_ONE_RIGHT_VAL},
  38              // {AD_KEY_ID_TWO_RIGHT, AD_KEY_TWO_RIGHT_VAL},
  39              // {AD_KEY_ID_THREE_RIGHT, AD_KEY_THREE_RIGHT_VAL},
  40          
  41              {AD_KEY_ID_1, AD_KEY_ID_1_VAL}, // 339
  42              {AD_KEY_ID_2, AD_KEY_ID_2_VAL}, // 1140
  43              {AD_KEY_ID_3, AD_KEY_ID_3_VAL}, // 1875
  44              {AD_KEY_ID_4, AD_KEY_ID_4_VAL}, // 2333
  45              {AD_KEY_ID_5, AD_KEY_ID_5_VAL}, // 3309
  46          };
  47          
  48          struct key_driver_para ad_key_para = {
  49              // .scan_times = 10,   // æ‰«æé¢‘ç‡ï¼Œå•ä½ï¼šms
  50              // .last_key = NO_KEY, // ä¸Šä¸€æ¬¡å¾—åˆ°çš„æŒ‰é”®é”®å€¼ï¼Œåˆå§‹åŒ–ä¸ºæ— æ•ˆçš„é”®å€¼
  51              // // .filter_value = NO_KEY, // æŒ‰é”®æ¶ˆæŠ–æœŸé—´å¾—åˆ°çš„é”®å€¼(åœ¨key_driver_scan()å‡½æ•°ä¸­ä½¿ç”¨
             -)ï¼Œåˆå§‹åŒ–ä¸º NO_KEY
C51 COMPILER V9.60.7.0   AD_KEY                                                            05/21/2025 18:01:23 PAGE 2   

  52              // // .filter_cnt = 0, // æŒ‰é”®æ¶ˆæŠ–æœŸé—´çš„ç´¯åŠ å€¼(åœ¨key_driver_scan()å‡½æ•°ä¸­ä½¿ç”¨)ï¼Œåˆå§‹
             -åŒ–ä¸º0
  53              // .filter_time = 3,       // æŒ‰é”®æ¶ˆæŠ–æ¬¡æ•°ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³
  54              // .long_time = 50,        // åˆ¤å®šæŒ‰é”®æ˜¯é•¿æŒ‰å¯¹åº”çš„æ•°é‡ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³
  55              // .hold_time = (75 + 15), // åˆ¤å®šæŒ‰é”®æ˜¯HOLDå¯¹åº”çš„æ•°é‡ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³
  56              // // .press_cnt = 0, // ä¸long_timeå’Œhold_timeå¯¹æ¯”, åˆ¤æ–­é•¿æŒ‰äº‹ä»¶å’ŒHOLDäº‹ä»¶
  57              // // .click_cnt = 0,
  58              // .click_delay_time = 20, // æŒ‰é”®æŠ¬èµ·åï¼Œç­‰å¾…è¿å‡»çš„æ•°é‡ï¼Œä¸æ‰«æé¢‘ç‡æœ‰å…³
  59              // // .notify_value = 0,
  60              // .key_type = KEY_TYPE_AD, // æŒ‰é”®ç±»å‹ä¸ºadæŒ‰é”®
  61              // .get_value = ad_key_get_key_id,
  62          
  63              // .latest_key_val = AD_KEY_ID_NONE,
  64              ad_key_para.latest_key_event = KEY_EVENT_NONE,
*** ERROR C247 IN LINE 64 OF ..\..\User\ad_key.c: non-address/-constant initializer
  65          };
  66          
  67          // å°†é‡‡é›†åˆ°çš„adå€¼è½¬æ¢æˆè‡ªå®šä¹‰çš„é”®å€¼
  68          static u16 __conver_cur_ad_to_ad_key(const u16 cur_ad_key)
  69          {
  70   1          u8 i = 0;
  71   1          u16 ad_key_id = AD_KEY_ID_NONE;
  72   1      
  73   1          // ARRAY_SIZE(ad_key_scan_table) è¿™é‡Œæ˜¯æ±‚å‡ºæ•°ç»„ä¸­å­˜æ”¾çš„æŒ‰é”®ä¸ªæ•°
  74   1          for (i = 0; i < ARRAY_SIZE(ad_key_scan_table); i++)
  75   1          {
  76   2              // if (cur_ad_key > (ad_key_scan_table[i][1] - AD_KEY_INTERVAL) &&
  77   2              //     cur_ad_key < (ad_key_scan_table[i][1] + AD_KEY_INTERVAL))
  78   2              // {
  79   2              //     // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹
  80   2              //     ad_key_id = ad_key_scan_table[i][0]; // è·å–adå€¼å¯¹åº”çš„é”®å€¼
  81   2              //     break;
  82   2              // }
  83   2      
  84   2              if (cur_ad_key < ad_key_scan_table[i][1])
  85   2              {
  86   3                  ad_key_id = ad_key_scan_table[i][0];
  87   3                  break;
  88   3              }
  89   2          }
  90   1      
  91   1          return ad_key_id;
  92   1      }
  93          
  94          u8 ad_key_get_key_id(void)
  95          {
  96   1          volatile u16 ad_key_id = 0;       // å•æ¬¡æŒ‰é”®æ ‡å¿—
  97   1          adc_sel_pin(ADC_PIN_KEY);         // å†…éƒ¨è‡³å°‘å ç”¨1ms
  98   1          ad_key_id = adc_single_convert(); // ç›´æ¥ç”¨å•æ¬¡è½¬æ¢,ä¸å–å¹³å‡å€¼,é˜²æ­¢è¯†åˆ«ä¸åˆ°æŒ‰é”®
  99   1          // printf("ad key val %u \n", ad_key_id);
 100   1          // printf("ad_key_id val %u\n", ad_key_id);
 101   1          ad_key_id = __conver_cur_ad_to_ad_key(ad_key_id); // å°†é‡‡é›†åˆ°çš„adå€¼è½¬æ¢æˆè‡ªå®šä¹‰çš„é”®å€¼
 102   1      
 103   1          // æµ‹è¯•ç”¨ï¼š
 104   1          // if (ad_key_id != 0)
 105   1          // {
 106   1          //     printf("ad key id %u\n", ad_key_id);
 107   1          // }
 108   1      
 109   1          return ad_key_id;
 110   1      }
 111          
C51 COMPILER V9.60.7.0   AD_KEY                                                            05/21/2025 18:01:23 PAGE 3   

 112          #if 0
              // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°
              // å†…éƒ¨çš„æ¯”è¾ƒåªä¼šæ¯”å¯¹è‡ªå®šä¹‰çš„é”®å€¼(id)
              void ad_key_scan(void)
              {
                  volatile u16 ad_key_id = 0;             // å•æ¬¡æŒ‰é”®æ ‡å¿—
                  static u16 ad_key_last_id = 0;          // ç”¨äºå­˜æ”¾é•¿æŒ‰æ—¶ï¼Œå¯¹åº”çš„æŒ‰é”®
                  static volatile u32 touch_time_cnt = 0; // é•¿æŒ‰è®¡æ•°å€¼
              
                  if (0 == flag_is_touch_key_scan_circle_arrived)
                  {
                      return;
                  }
              
                  flag_is_touch_key_scan_circle_arrived = 0;
              
                  adc_sel_pin(ADC_PIN_KEY);         // å†…éƒ¨è‡³å°‘å ç”¨1ms
                  ad_key_id = adc_single_convert(); // ç›´æ¥ç”¨å•æ¬¡è½¬æ¢,ä¸å–å¹³å‡å€¼,é˜²æ­¢è¯†åˆ«ä¸åˆ°æŒ‰é”®
                  // printf("ad key val %u \n", ad_key_id);
                  // printf("ad_key_id val %u\n", ad_key_id);
                  ad_key_id = __conver_cur_ad_to_ad_key(ad_key_id); // å°†é‡‡é›†åˆ°çš„adå€¼è½¬æ¢æˆè‡ªå®šä¹‰çš„é”®å€¼
              
                  // æµ‹è¯•ç”¨ï¼š
                  // if (ad_key_id != 0)
                  // {
                  //     printf("ad key id %u\n", ad_key_id);
                  // }
              
                  //
                  //     if (0 != ad_key_id)
                  //     {
                  //         printf("ad_key_id id : %u\n", ad_key_id);
                  //     }
              
              #if 0
                  if (AD_KEY_SCAN_STATUS_NONE == ad_key_scan_status) // æœªæ£€æµ‹åˆ°æŒ‰é”®æ—¶
                  {
                      // å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆå¹¶ä¸”ä¹‹å‰æ‰«æåˆ°çš„ä¸æ˜¯é•¿æŒ‰ï¼‰
                      // åˆ¤æ–­æ˜¯å¦ä¸ºé•¿æŒ‰ï¼š
              
                      if (0 == ad_key_last_id)
                      {
                          // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®ï¼Œç°åœ¨æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹:
                          ad_key_last_id = ad_key_id;
                      }
                      else if (ad_key_last_id == ad_key_id)
                      {
                          // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ç›¸ç­‰ï¼Œè¯´æ˜æŒ‰é”®è¿˜æœªæ¾å¼€
                          // touch_time_cnt += (1 + ONE_CYCLE_TIME_MS);
                          touch_time_cnt += (TOUCH_KEY_SCAN_CIRCLE_TIMES);
              
                          if (touch_time_cnt >= LONG_PRESS_TIME_THRESHOLD_MS)
                          {
                              // å¦‚æœé•¿æŒ‰è¶…è¿‡äº†è®¾ç½®çš„é•¿æŒ‰æ—¶é—´
                              // è·³è½¬åˆ°é•¿æŒ‰å¤„ç†
                              touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°
              #if USE_MY_DEBUG
                              printf("long press\n"); // æµ‹è¯•ç”¨
              #endif
                              ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS;
                          }
                      }
C51 COMPILER V9.60.7.0   AD_KEY                                                            05/21/2025 18:01:23 PAGE 4   

                      else
                      {
                          // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ä¸ç›¸ç­‰ï¼Œå¹¶ä¸”ä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä
             -¸ç­‰äº0
                          // touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°ï¼ˆå¯ä»¥ç•™åˆ°æ”¶å°¾å¤„ç†ï¼‰
              
                          // è·³è½¬åˆ°çŸ­æŒ‰å¤„ç†
                          ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS;
              #if USE_MY_DEBUG
                          printf("short press\n"); // æµ‹è¯•ç”¨
              #endif
                      }
              
                      // delay_ms(1); //
                  }
              
                  if (AD_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS == ad_key_scan_status)
                  {
                      // å¦‚æœæ˜¯æ­£åœ¨å¤„ç†çŸ­æŒ‰
                      if (AD_KEY_ID_1 == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
                            printf("key 1 press\n");
              #if USE_MY_DEBUG
                          printf("one left press\n");
              #endif
                          // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_DEC);
                      }
                      else if (AD_KEY_ID_2 == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
                             printf("key 2 press\n");
              #if USE_MY_DEBUG
                          printf("two left press\n");
              #endif
                          // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MUTE);
                      }
                      else if (AD_KEY_ID_3 == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
                             printf("key 3 press\n");
              #if USE_MY_DEBUG
                          printf("three left press\n");
              #endif
                          // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_INC);
                      }
                      else if (AD_KEY_ID_4 == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
                             printf("key 4 press\n");
              #if USE_MY_DEBUG
                          printf("one right press\n");
              #endif
                          // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_PRE);
                      }
                      else if (AD_KEY_ID_5 == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
                             printf("key 5 press\n");
              #if USE_MY_DEBUG
                          printf("two right press\n");
              #endif
C51 COMPILER V9.60.7.0   AD_KEY                                                            05/21/2025 18:01:23 PAGE 5   

                          // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MODE);
                      }
                      else
                      {
                          // å¦‚æœæ²¡æœ‰æŒ‰é”®è¢«è§¦æ‘¸
                      }
              
                      ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE;
                  }
              
                  if (AD_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS == ad_key_scan_status)
                  {
                      // å¤„ç†é•¿æŒ‰
                      if (AD_KEY_ID_ONE_LEFT == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              #if USE_MY_DEBUG
                          // printf("one left long press\n");
              #endif
                          // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
                      }
                      else if (AD_KEY_ID_TWO_LEFT == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              #if USE_MY_DEBUG
                          printf("two left long press\n");
              #endif
                          // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_POWER);
                      }
                      else if (AD_KEY_ID_THREE_LEFT == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              #if USE_MY_DEBUG
                          // printf("three left long press\n");
              #endif
                          // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
                      }
                      else if (AD_KEY_ID_ONE_RIGHT == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              #if USE_MY_DEBUG
                          // printf("one right long press\n");
              #endif
                          // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
                      }
                      else if (AD_KEY_ID_TWO_RIGHT == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              #if USE_MY_DEBUG
                          printf("two right long press\n");
              #endif
                          // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_MAIN);
                      }
                      else if (AD_KEY_ID_THREE_RIGHT == ad_key_last_id)
                      {
                          // å¦‚æœ  è¢«è§¦æ‘¸
              
              #if USE_MY_DEBUG
                          // printf("three right long press\n");
              #endif
                          // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰å¯¹åº”çš„æ“ä½œ
                      }
C51 COMPILER V9.60.7.0   AD_KEY                                                            05/21/2025 18:01:23 PAGE 6   

              
                      ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS; // è·³è½¬åˆ°é•¿æŒ‰æŒç»­
                  }
              
                  if (AD_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS == ad_key_scan_status)
                  {
                      // å¤„ç†é•¿æŒ‰æŒç»­
              
                      if (ad_key_last_id == ad_key_id)
                      {
                          touch_time_cnt+=TOUCH_KEY_SCAN_CIRCLE_TIMES;
                          if (AD_KEY_ID_ONE_LEFT == ad_key_last_id)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  printf("one left continue press\n");
              #endif
                                  // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_DEC);
                              }
                          }
                          else if (AD_KEY_ID_TWO_LEFT == ad_key_last_id)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("two left continue press\n");
              #endif
                                  // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
                              }
                          }
                          else if (AD_KEY_ID_THREE_LEFT == ad_key_last_id)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("three left continue press\n");
              #endif
                                  // send_data(SEND_TOUCH_KEY_STATUS, TOUCH_KEY_VAL_VOL_INC);
                              }
                          }
                          else if (AD_KEY_ID_ONE_RIGHT == ad_key_last_id)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("one right continue press\n");
              #endif
                                  // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
                              }
                          }
                          else if (AD_KEY_ID_TWO_RIGHT == ad_key_last_id)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("two right continue press\n");
C51 COMPILER V9.60.7.0   AD_KEY                                                            05/21/2025 18:01:23 PAGE 7   

              #endif
                                  // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
                              }
                          }
                          else if (AD_KEY_ID_THREE_RIGHT == ad_key_last_id)
                          {
                              if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
                              {
                                  touch_time_cnt = 0;
              #if USE_MY_DEBUG
                                  // printf("three right continue press\n");
              #endif
                                  // è¿™ä¸ªæŒ‰é”®æ²¡æœ‰é•¿æŒ‰æŒç»­å¯¹åº”çš„æ“ä½œ
                              }
                          }
              
                          delay_ms(1);
                      }
                      else
                      {
                          // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸å½“å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸ä¸€è‡´ï¼Œ
                          // è¯´æ˜ å¯èƒ½æ¾å¼€äº†æ‰‹ æˆ–æ˜¯ ä¸€åªæ‰‹æŒ‰ä½äº†åŸæ¥çš„æŒ‰é”®å¦ä¸€åªæ‰‹æŒ‰äº†å…¶ä»–æ
             -Œ‰é”®
              
                          // è·³è½¬åˆ°ç­‰å¾…é•¿æŒ‰æ¾å¼€
                          ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE;
                      }
                  }
              
                  if ((AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == ad_key_scan_status) ||
                      (AD_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE == ad_key_scan_status))
                  {
                      // å¦‚æœæ˜¯ç­‰å¾…æŒ‰é”®æ¾å¼€
                      static volatile u16 loose_cnt = 0; // å­˜æ”¾æ¾æ‰‹è®¡æ•°å€¼
              
                      if (0 == ad_key_id)
                      {
                          // å¦‚æœå½“å‰æ£€æµ‹åˆ°ä¸€æ¬¡é”®å€¼idä¸ºç©º
                          loose_cnt += ONE_CYCLE_TIME_MS;
                          // delay_ms(1);
                      }
                      else
                      {
                          // åªè¦æœ‰ä¸€æ¬¡æ£€æµ‹åˆ°æŒ‰é”®ï¼Œè¯´æ˜æ²¡æœ‰æ¾å¼€æ‰‹
                          loose_cnt = 0;
                      }
              
                      if (loose_cnt >= LOOSE_PRESS_CNT_MS) // è¿™é‡Œçš„æ¯”è¾ƒå€¼éœ€è¦æ³¨æ„ï¼Œä¸èƒ½å¤§äºå˜é‡ç±»å‹å
             -¯¹åº”çš„æœ€å¤§å€¼
                      {
                          loose_cnt = 0; // æ¸…ç©ºæ¾æ‰‹è®¡æ•°
                          // å¦‚æœ xx mså†…æ²¡æœ‰æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹ï¼Œè¯´æ˜å·²ç»æ¾å¼€æ‰‹
              
                          if (AD_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == ad_key_scan_status)
                          {
                              if (AD_KEY_ID_ONE_LEFT == ad_key_last_id)
                              {
              #if USE_MY_DEBUG
                                  // printf("one left long press loose\n");
              #endif
                              }
                              else if (AD_KEY_ID_TWO_LEFT == ad_key_last_id)
C51 COMPILER V9.60.7.0   AD_KEY                                                            05/21/2025 18:01:23 PAGE 8   

                              {
              #if USE_MY_DEBUG
                                  // printf("two left long press loose\n");
              #endif
                              }
                              else if (AD_KEY_ID_THREE_LEFT == ad_key_last_id)
                              {
              #if USE_MY_DEBUG
                                  // printf("three left long press loose\n");
              #endif
                              }
                              else if (AD_KEY_ID_ONE_RIGHT == ad_key_last_id)
                              {
              #if USE_MY_DEBUG
                                  // printf("one right long press loose\n");
              #endif
                              }
                              else if (AD_KEY_ID_TWO_RIGHT == ad_key_last_id)
                              {
              #if USE_MY_DEBUG
                                  // printf("two right long press loose\n");
              #endif
                              }
                              else if (AD_KEY_ID_THREE_RIGHT == ad_key_last_id)
                              {
              #if USE_MY_DEBUG
                                  // printf("three right long press loose\n");
              #endif
                              }
                          }
              
                          ad_key_scan_status = AD_KEY_SCAN_STATUS_IS_END; // è·³è½¬åˆ°æ”¶å°¾å¤„ç†
                      }
                  }
              
                  if (AD_KEY_SCAN_STATUS_IS_END == ad_key_scan_status)
                  {
                      // æ”¶å°¾å¤„ç†
                      ad_key_id = 0;
                      ad_key_last_id = 0;
                      touch_time_cnt = 0;
              
                      ad_key_scan_status = AD_KEY_SCAN_STATUS_NONE;
                  }
              #endif
              }
              
              #endif

C51 COMPILATION COMPLETE.  0 WARNING(S),  1 ERROR(S)
