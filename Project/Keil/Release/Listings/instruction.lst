C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE INSTRUCTION
OBJECT MODULE PLACED IN .\Release\Objects\instruction.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\instruction.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTOR(0
                    -X000C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\R
                    -elease\Listings\instruction.lst) OBJECT(.\Release\Objects\instruction.obj)

line level    source

   1          #include "instruction.h"
   2          
   3          #include <string.h> // memset()
   4          
   5          // ç”¨bitå®šä¹‰ï¼Œæ¥èŠ‚çœç©ºé—´
   6          // ä¸‹é¢çš„æ ‡å¿—ä½ï¼Œæœ‰å¯èƒ½æ˜¯ä»ä¸²å£æ¥æ”¶åˆ°äº†æŒ‡ä»¤æ¥ç½®ä½ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å…¶ä»–çš„æ‰«æå
             -‡½æ•°æ›´æ–°äº†çŠ¶æ€æ¥ç½®ä½
   7          volatile bit flag_get_all_status = 0;   // è·å–æ‰€æœ‰åŠŸèƒ½çš„çŠ¶æ€
   8          volatile bit flag_get_gear = 0;         // è·å–æŒ¡ä½çŠ¶æ€ / å¾—åˆ°äº†æŒ¡ä½çš„çŠ¶æ€
   9          volatile bit flag_get_battery = 0;      // è·å–ç”µæ± çŠ¶æ€ / å¾—åˆ°äº†ç”µæ± çš„çŠ¶æ€ï¼ˆç”µæ± ç”µé‡ï¼Œ
             -å•ä½ï¼šç™¾åˆ†æ¯”ï¼‰
  10          volatile bit flag_get_brake = 0;        // è·å–åˆ¹è½¦çŠ¶æ€ / å¾—åˆ°äº†åˆ¹è½¦çš„çŠ¶æ€
  11          volatile bit flag_get_left_turn = 0;    // è·å–å·¦è½¬å‘ç¯çš„çŠ¶æ€ / å¾—åˆ°äº†å·¦è½¬å‘ç¯çš„çŠ¶æ€
  12          volatile bit flag_get_right_turn = 0;   // è·å–å³è½¬å‘ç¯çš„çŠ¶æ€ / å¾—åˆ°äº†å³è½¬å‘ç¯çš„çŠ¶æ€
  13          volatile bit flag_get_high_beam = 0;    // è·å–è¿œå…‰ç¯çš„çŠ¶æ€ / å¾—åˆ°äº†è¿œå…‰ç¯çš„çŠ¶æ€
  14          volatile bit flag_get_engine_speed = 0; // è·å–å‘åŠ¨æœºçš„è½¬é€Ÿ / å¾—åˆ°äº†å‘åŠ¨æœºçš„è½¬é€Ÿ
  15          volatile bit flag_get_speed = 0;        // è·å–æ—¶é€Ÿ / å¾—åˆ°äº†æ—¶é€Ÿ
  16          volatile bit flag_get_fuel = 0;         // è·å–æ²¹é‡ / å¾—åˆ°äº†æ²¹é‡ï¼ˆå•ä½ï¼šç™¾åˆ†æ¯”ï¼‰
  17          // volatile bit flag_get_temp_of_water = 0; // è·å–æ°´æ¸© / å¾—åˆ°äº†æ°´æ¸©
  18          
  19          volatile bit flag_update_malfunction_status; // æ ‡å¿—ä½ï¼Œæ›´æ–°æ•…éšœçŠ¶æ€
  20          volatile bit flag_update_abs_status;         // æ ‡å¿—ä½ï¼Œæ›´æ–°absçš„çŠ¶æ€
  21          
  22          volatile bit flag_get_total_mileage = 0;     // è·å–å¤§è®¡é‡Œç¨‹ / å¾—åˆ°äº†å¤§è®¡é‡Œç¨‹
  23          volatile bit flag_get_sub_total_mileage = 0; // è·å–å°è®¡é‡Œç¨‹ / å¾—åˆ°äº†å°è®¡é‡Œç¨‹
  24          
  25          // volatile bit flag_get_touch_key_status = 0; // è·å–è§¦æ‘¸æŒ‰é”®çš„çŠ¶æ€
  26          // volatile bit flag_alter_date = 0; // ä¿®æ”¹æ—¥æœŸ
  27          volatile bit flag_alter_time = 0; // ä¿®æ”¹æ—¶é—´
  28          
  29          volatile bit flag_get_voltage_of_battery = 0;    // è·å–ç”µæ± ç”µå‹
  30          volatile bit flag_set_temp_of_water_warning = 0; // è®¾ç½®æ°´æ¸©æŠ¥è­¦
  31          
  32          volatile bit flag_clear_total_mileage = 0;     // æ¸…é™¤å¤§è®¡é‡Œç¨‹
  33          volatile bit flag_clear_sub_total_mileage = 0; // æ¸…é™¤å°è®¡é‡Œç¨‹
  34          
  35          volatile u8 synchronous_request_status = 0;    // åŒæ­¥è¯·æ±‚çŠ¶æ€æœº
  36          volatile u16 synchronous_request_time_cnt = 0; // åŒæ­¥è¯·æ±‚æ—¶é—´è®¡æ—¶
  37          
  38          volatile u8 update_time_status = 0; // æ›´æ–°æ—¶é—´çš„çŠ¶æ€æœº
  39          volatile u8 update_date_status = 0; // æ›´æ–°æ—¥æœŸçš„çŠ¶æ€æœº
  40          
  41          volatile u16 update_time_cooling_cnt = 0; // æ›´æ–°æ—¶é—´çš„å†·å´è®¡æ•°
  42          volatile u16 update_date_cooling_cnt = 0; // æ›´æ–°æ—¥æœŸçš„å†·å´è®¡æ•°
  43          
  44          // // å­˜æ”¾æ¥æ”¶åˆ°çš„è®¾ç½®æ°´æ¸©æŠ¥è­¦çš„æŒ‡ä»¤ä¸­ï¼Œå¯¹åº”çš„æ“ä½œï¼Œé»˜è®¤ä¸ºæ— æ“ä½œ
  45          // volatile u8 operation_set_temp_of_water_warning = OPERATION_SET_TEMP_OF_WATER_WARNING_NONE;
  46          
  47          // æ£€æŸ¥æ¥æ”¶æ˜¯å¦æ­£ç¡®çš„å‡½æ•°ï¼Œå¦‚æœæ¥æ”¶æ­£ç¡®ï¼Œ
  48          // æ ¹æ®æ¥æ”¶åˆ°çš„æ•°æ®ä¸­çš„æŒ‡ä»¤ï¼Œç»™å¯¹åº”çš„æŒ‡ä»¤çš„æ ‡å¿—ä½ç½®ä¸€
  49          void instruction_scan(void)
  50          {
  51   1          u8 i = 0; // æ³¨æ„è¦å¤§äºç­‰äºç¼“å†²åŒºèƒ½å­˜æ”¾çš„æŒ‡ä»¤æ•°ç›®
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 2   

  52   1          for (i = 0; i < (UART0_RXBUF_LEN) / (FRAME_MAX_LEN); i++)
  53   1          {
  54   2              if (flagbuf_valid_instruction[i]) // å¦‚æœå¯¹åº”çš„ä½ç½®æœ‰åˆæ³•çš„æ•°æ®å¸§
  55   2              {
  56   3                  // æ ¹æ®æ¥æ”¶åˆ°æ•°æ®ä¸­çš„æŒ‡ä»¤ï¼Œç»™å¯¹åº”çš„æŒ‡ä»¤çš„æ ‡å¿—ä½ç½®ä¸€
  57   3                  // if (4 == uart0_recv_buf[i][1]) // å¦‚æœæ˜¯å››ä½é•¿åº¦çš„æŒ‡ä»¤
  58   3                  {
  59   4                      switch (uart0_recv_buf[i][2]) // æ ¹æ®ä¸åŒçš„æŒ‡ä»¤æ¥ç»™å¯¹åº”çš„æ ‡å¿—ä½ç½®ä¸€
  60   4                      {
  61   5                      case INSTRUCTION_GET_ALL_STATUS: // è·å–æ‰€æœ‰åŠŸèƒ½çš„çŠ¶æ€
  62   5                          flag_get_all_status = 1;
  63   5                          break;
  64   5      
  65   5      #if 0  // ä¸å¯¹MP5å‘é€çš„è¿™äº›æŒ‡ä»¤è¿›è¡Œå¤„ç†
                     // case INSTRUCTION_GET_GEAR: // è·å–æŒ¡ä½çš„çŠ¶æ€
                     //     flag_get_gear = 1;
                     //     break;
              
                              // case INSTRUCTION_GET_BATTERY: // è·å–ç”µæ± ç”µé‡çš„çŠ¶æ€
                              //     flag_get_battery = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_BARKE: // è·å–åˆ¹è½¦çš„çŠ¶æ€
                              //     flag_get_brake = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_LEFT_TURN: // è·å–å·¦è½¬å‘ç¯çš„çŠ¶æ€
                              //     flag_get_left_turn = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_RIGHT_TURN: // è·å–å³è½¬å‘ç¯çš„çŠ¶æ€
                              //     flag_get_right_turn = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_HIGH_BEAM: // è·å–è¿œå…‰ç¯çš„çŠ¶æ€
                              //     flag_get_high_beam = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_ENGINE_SPEED: // è·å–å‘åŠ¨æœºè½¬é€Ÿ
                              //     flag_get_engine_speed = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_SPEED: // è·å–æ—¶é€Ÿ
                              //     flag_get_speed = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_FUEL: // è·å–æ²¹é‡
                              //     flag_get_fuel = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_TEMP_OF_WATER: // è·å–æ°´æ¸©
                              //     flag_get_temp_of_water = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_TOTAL_MILEAGE: // è·å–å¤§è®¡é‡Œç¨‹
                              //     flag_get_total_mileage = 1;
                              //     break;
              
                              // case INSTRUCTION_GET_SUBTOTAL_MILEAGE: // è·å–å°è®¡é‡Œç¨‹
                              //     flag_get_sub_total_mileage = 1;
                              //     break;
              
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 3   

                              // case INSTRUCTION_GET_TOUCH_KEY_STATUS: // è·å–è§¦æ‘¸æŒ‰é”®çš„çŠ¶æ€
                              //     flag_get_touch_key_status = 1;
                              //     break;
              
                     
              
                            
              
                              // case INSTRUCTION_GET_BATTERY_VAL: // è·å–ç”µæ± ç”µå‹
                              //     flag_get_voltage_of_battery = 1;
                              //     break;
              
                              // case INSTRUCTION_SET_TEMP_OF_WATER_WARNING: // è®¾ç½®æ°´æ¸©æŠ¥è­¦
                              //     flag_set_temp_of_water_warning = 1;
              
                              //     break;
              #endif // ä¸å¯¹MP5å‘é€çš„è¿™äº›æŒ‡ä»¤è¿›è¡Œå¤„ç†
 131   5      
 132   5      #if 0 // ä¿®æ”¹æ—¥æœŸ
                              case INSTRUCTION_ALTER_DATE: // ä¿®æ”¹æ—¥æœŸ
                                  flag_alter_date = 1;
                                  fun_info.aip1302_saveinfo.year = (u16)uart0_recv_buf[i][3] +
                                                                   (u16)uart0_recv_buf[i][4];
                                  fun_info.aip1302_saveinfo.month = uart0_recv_buf[i][5];
                                  fun_info.aip1302_saveinfo.day = uart0_recv_buf[i][6];
              
              #if USE_MY_DEBUG
              #if 1 // æ‰“å°ä¸²å£ç¼“å†²åŒºçš„æ•°æ®
              
                                  {
                                      u8 i = 0;
                                      u8 j = 0;
                                      for (i = 0; i < (UART0_RXBUF_LEN) / (FRAME_MAX_LEN); i++)
                                      {
                                          printf("buff_index %bu ", i);
                                          for (j = 0; j < FRAME_MAX_LEN; j++)
                                          {
                                              printf("%bx ", uart0_recv_buf[i][j]);
                                          }
                                          printf("\n");
                                      }
                                  }
              
              #endif // æ‰“å°ä¸²å£ç¼“å†²åŒºçš„æ•°æ®
              #endif
              
                                  break;
              #endif // ä¿®æ”¹æ—¥æœŸ
 162   5      
 163   5                      case INSTRUCTION_ALTER_TIME: // ä¿®æ”¹æ—¶é—´
 164   5                          flag_alter_time = 1;
 165   5      
 166   5                          fun_info.aip1302_saveinfo.year = (u16)uart0_recv_buf[i][3] +
 167   5                                                           (u16)uart0_recv_buf[i][4];
 168   5                          fun_info.aip1302_saveinfo.month = uart0_recv_buf[i][5];
 169   5                          fun_info.aip1302_saveinfo.day = uart0_recv_buf[i][6];
 170   5      
 171   5                          fun_info.aip1302_saveinfo.time_hour = uart0_recv_buf[i][7];
 172   5                          fun_info.aip1302_saveinfo.time_min = uart0_recv_buf[i][8];
 173   5                          fun_info.aip1302_saveinfo.time_sec = uart0_recv_buf[i][9];
 174   5      
 175   5      #if USE_MY_DEBUG
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 4   

              #if 1 // æ‰“å°ä¸²å£ç¼“å†²åŒºçš„æ•°æ®
              
                                  {
                                      u8 i = 0;
                                      u8 j = 0;
                                      for (i = 0; i < (UART0_RXBUF_LEN) / (FRAME_MAX_LEN); i++)
                                      {
                                          printf("buff_index %bu ", i);
                                          for (j = 0; j < FRAME_MAX_LEN; j++)
                                          {
                                              printf("%bx ", uart0_recv_buf[i][j]);
                                          }
                                          printf("\n");
                                      }
                                  }
              
              #endif // æ‰“å°ä¸²å£ç¼“å†²åŒºçš„æ•°æ®
              #endif
 194   5      
 195   5                          break;
 196   5      
 197   5                      case INSTRUCTION_CLEAR_TOTAL_MILEAGE: // æ¸…é™¤å¤§è®¡é‡Œç¨‹
 198   5                          flag_clear_total_mileage = 1;
 199   5                          break;
 200   5      
 201   5                      case INSTRUCTION_CLEAR_SUBTOTAL_MILEAGE: // æ¸…é™¤å°è®¡é‡Œç¨‹
 202   5                          flag_clear_sub_total_mileage = 1;
 203   5                          // printf("clear\n");
 204   5                          break;
 205   5                      }
 206   4      
 207   4                      if (recv_frame_cnt > 0) //
 208   4                      {
 209   5                          recv_frame_cnt--; // ä»ä¸²å£æ¥æ”¶çš„æ•°æ®å¸§æ•°ç›®å‡ä¸€ï¼Œè¡¨ç¤ºæŒ‡ä»¤å·²ç»ä»ç¼
             -“å†²åŒºå–å‡º
 210   5                      }
 211   4      
 212   4                      flagbuf_valid_instruction[i] = 0; // æ¸…ç©ºç¼“å†²åŒºå¯¹åº”çš„å…ƒç´ ï¼Œè¡¨ç¤ºè¯¥ä¸‹æ ‡çš„æŒ
             -‡ä»¤å·²ç»å¤„ç†
 213   4                      uart0_recv_len[i] = 0;
 214   4                      recved_flagbuf[i] = 0;
 215   4                      memset(uart0_recv_buf[i], 0, FRAME_MAX_LEN); // æ¸…ç©ºç¼“å†²åŒºå¯¹åº”çš„å…ƒç´ 
 216   4                  } // if (4 == uart0_recv_buf[i][1])
 217   3              }
 218   2          }
 219   1      }
 220          
 221          void instruction_handle(void)
 222          {
 223   1          if (flag_get_all_status)
 224   1          {
 225   2              // å¦‚æœè¦è·å–æ‰€æœ‰åŠŸèƒ½çš„çŠ¶æ€
 226   2              u32 temp_val = 0;        // ä¸´æ—¶å˜é‡(åœ¨å‘é€æ—¥æœŸå’Œæ—¶é—´ä½¿ç”¨åˆ°)
 227   2              flag_get_all_status = 0; // æ¸…é™¤æ ‡å¿—ä½
 228   2      
 229   2      #if USE_MY_DEBUG
                      printf(" flag_get_all_status\n");
              #endif
 232   2      
 233   2              if (synchronous_request_status == SYN_REQUEST_STATUS_NONE)
 234   2              {
 235   3                  // printf("handle get_all_status\n");// æµ‹è¯•é€šè¿‡ï¼Œæ¯æ¬¡æ”¶åˆ°åŒæ­¥è¯·æ±‚ï¼Œéƒ½ä¼šç­‰å¾…
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 5   

             -å†·å´åï¼Œæ‰å¤„ç†ä¸‹ä¸€æ¬¡åŒæ­¥è¯·æ±‚
 236   3                  synchronous_request_status = SYN_REQUEST_STATUS_HANDLING;
 237   3                  // è·å–æ‰€æœ‰åŠŸèƒ½çš„çŠ¶æ€ï¼Œéœ€è¦æŠŠè¿™äº›åŠŸèƒ½å¯¹åº”çš„çŠ¶æ€éƒ½å‘é€å‡ºå»
 238   3                  send_data(SEND_GEAR, fun_info.gear);                                         // 1. å‘é€å½“å‰
             -æŒ¡ä½çš„çŠ¶æ€
 239   3                  send_data(SEND_BATTERY, fun_info.battery);                                   // 2. å‘é€ç”µæ±
             - ç”µé‡
 240   3                  send_data(SEND_BARKE, fun_info.brake);                                       // 3. å‘é€å½“å‰
             -åˆ¹è½¦çš„çŠ¶æ€
 241   3                  send_data(SEND_LEFT_TURN, fun_info.left_turn);                               // 4. å‘é€å½“å‰
             -å·¦è½¬å‘ç¯çš„çŠ¶æ€
 242   3                  send_data(SEND_RIGHT_TURN, fun_info.right_turn);                             // 5. å‘é€å½“å‰
             -å³è½¬å‘ç¯çš„çŠ¶æ€
 243   3                  send_data(SEND_HIGH_BEAM, fun_info.high_beam);                               // 6. å‘é€å½“å‰
             -è¿œå…‰ç¯çš„çŠ¶æ€
 244   3                  send_data(SEND_ENGINE_SPEED, fun_info.engine_speeed);                        // 7. å‘é€å‘åŠ
             -¨æœºè½¬é€Ÿ
 245   3                  send_data(SEND_SPEED, fun_info.speed);                                       // 8. å‘é€å½“å‰
             -é‡‡é›†åˆ°çš„è½¦é€Ÿï¼ˆæ—¶é€Ÿï¼‰
 246   3                  send_data(SEND_FUEL, fun_info.fuel);                                         // 9. å‘é€å½“å‰
             -æ²¹é‡(å•ä½ï¼šç™¾åˆ†æ¯”)
 247   3                                                                                               // send_data(SEND
             -_WATER_TEMP, fun_info.temp_of_water);                          // 10. å‘é€å½“å‰é‡‡é›†çš„æ°´æ¸©
 248   3      #ifdef USE_INTERNATIONAL                                                                 // å…¬åˆ¶å•ä½
 249   3                  send_data(SEND_TOTAL_MILEAGE, fun_info.save_info.total_mileage / 1000);      // 11. å‘é€å¤§è
             -®¡é‡Œç¨‹ï¼ˆåªå‘é€åƒç±³åŠä»¥ä¸Šçš„æ•°æ®ï¼‰
 250   3                  send_data(SEND_SUBTOTAL_MILEAGE, fun_info.save_info.subtotal_mileage / 100); // 12. å‘é€å°è
             -®¡é‡Œç¨‹(åªå‘é€ç™¾ç±³åŠä»¥ä¸Šçš„æ•°æ®)
 251   3      #endif                                                                                   // USE_INTERNATIO
             -NAL å…¬åˆ¶å•ä½
 252   3      
 253   3      #ifdef USE_IMPERIAL // è‹±åˆ¶å•ä½
              
                          send_data(SEND_TOTAL_MILEAGE, fun_info.save_info.total_mileage / 1610);      // 11. å‘é€å¤§è
             -®¡é‡Œç¨‹ï¼ˆåªå‘é€1è‹±é‡ŒåŠä»¥ä¸Šçš„æ•°æ®ï¼‰
                          send_data(SEND_SUBTOTAL_MILEAGE, fun_info.save_info.subtotal_mileage / 161); // 12. å‘é€å°è
             -®¡é‡Œç¨‹(åªå‘é€0.1è‹±é‡ŒåŠä»¥ä¸Šçš„æ•°æ®)
              
              #endif // USE_IMPERIAL è‹±åˆ¶å•ä½
 259   3      
 260   3                  // 13. å‘é€è§¦æ‘¸æŒ‰é”®çš„çŠ¶æ€
 261   3                  // send_data(SEND_TOUCH_KEY_STATUS, fun_info.touch_key_val);
 262   3                  aip1302_read_all(); // å…ˆä»aip1302æ—¶é’Ÿicè·å–æ‰€æœ‰å…³äºæ—¶é—´çš„ä¿¡æ¯ï¼Œå†å‘é€
 263   3                  // 14. å‘é€å½“å‰æ—¥æœŸ
 264   3                  //     temp_val = ((u32)fun_info.aip1302_saveinfo.year << 16) |
 265   3                  //                ((u32)fun_info.aip1302_saveinfo.month << 8) |
 266   3                  //                fun_info.aip1302_saveinfo.day;
 267   3                  //     send_data(SEND_DATE, temp_val);
 268   3                  // 15. å‘é€å½“å‰æ—¶é—´
 269   3                  //     temp_val = ((u32)fun_info.aip1302_saveinfo.time_hour << 16) |
 270   3                  //                ((u32)fun_info.aip1302_saveinfo.time_min << 8) |
 271   3                  //                fun_info.aip1302_saveinfo.time_sec;
 272   3                  //     send_data(SEND_TIME, temp_val);
 273   3                  send_data(SEND_TIME, 0); // ç¬¬äºŒä¸ªå‚æ•°æ— æ•ˆ
 274   3                  // 16. å‘é€å½“å‰çš„ç”µæ± ç”µå‹
 275   3                  send_data(SEND_VOLTAGE_OF_BATTERY, fun_info.voltage_of_battery);
 276   3                  // 17. å‘é€å½“å‰çš„æ°´æ¸©æŠ¥è­¦çŠ¶æ€
 277   3                  send_data(SEND_TEMP_OF_WATER_ALERT, fun_info.flag_is_in_water_temp_warning);
 278   3              }
 279   2          }
 280   1      
 281   1          if (flag_get_gear) // å¦‚æœè¦è·å–æŒ¡ä½çš„çŠ¶æ€
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 6   

 282   1          {
 283   2              flag_get_gear = 0; //
 284   2      
 285   2      #if USE_MY_DEBUG
                      // printf(" flag_get_gear\n");
              #endif
 288   2      
 289   2              send_data(SEND_GEAR, fun_info.gear); // å‘é€å½“å‰æŒ¡ä½çš„çŠ¶æ€
 290   2                                                   // printf("cur gear %u\n", fun_info.gear);
 291   2          } //  if (flag_get_gear) // å¦‚æœè¦è·å–æŒ¡ä½çš„çŠ¶æ€
 292   1      
 293   1          if (flag_get_battery)
 294   1          {
 295   2              // å¦‚æœè¦è·å–ç”µæ± ç”µé‡çš„çŠ¶æ€
 296   2              flag_get_battery = 0;
 297   2      #if USE_MY_DEBUG
                      // printf(" flag_get_battery\n");
              #endif
 300   2      
 301   2              send_data(SEND_BATTERY, fun_info.battery); // å‘é€ç”µæ± ç”µé‡
 302   2          }
 303   1      
 304   1      #if 0 // å‘é€åˆ¹è½¦çš„çŠ¶æ€
                  if (flag_get_brake)
                  {
                      // å¦‚æœè¦è·å–è·å–åˆ¹è½¦çš„çŠ¶æ€
                      flag_get_brake = 0;
              
              #if USE_MY_DEBUG
                      // printf(" flag_get_brake\n");
              #endif
              
                      send_data(SEND_BARKE, fun_info.brake); // å‘é€å½“å‰åˆ¹è½¦çš„çŠ¶æ€
                  }
              #endif // å‘é€åˆ¹è½¦çš„çŠ¶æ€
 317   1      
 318   1          if (flag_get_left_turn) // å¦‚æœè¦è·å–å·¦è½¬å‘ç¯çš„çŠ¶æ€
 319   1          {
 320   2              flag_get_left_turn = 0;
 321   2      
 322   2      #if USE_MY_DEBUG
                      // printf(" flag_get_left_turn\n");
              #endif
 325   2      
 326   2              send_data(SEND_LEFT_TURN, fun_info.left_turn); // å‘é€å½“å‰å·¦è½¬å‘ç¯çš„çŠ¶æ€
 327   2          } // if (flag_get_left_turn) // å¦‚æœè¦è·å–å·¦è½¬å‘ç¯çš„çŠ¶æ€
 328   1      
 329   1          if (flag_get_right_turn)
 330   1          {
 331   2              // å¦‚æœè¦è·å–å³è½¬å‘ç¯çš„çŠ¶æ€
 332   2              flag_get_right_turn = 0;
 333   2      #if USE_MY_DEBUG
                      // printf(" flag_get_right_turn\n");
              #endif
 336   2              send_data(SEND_RIGHT_TURN, fun_info.right_turn); // å‘é€å½“å‰å³è½¬å‘ç¯çš„çŠ¶æ€
 337   2          }
 338   1      
 339   1          if (flag_get_high_beam)
 340   1          {
 341   2              // å¦‚æœè¦è·å–è¿œå…‰ç¯çš„çŠ¶æ€
 342   2              flag_get_high_beam = 0;
 343   2      #if USE_MY_DEBUG
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 7   

                      // printf(" flag_get_high_beam\n");
              #endif
 346   2              send_data(SEND_HIGH_BEAM, fun_info.high_beam); // å‘é€å½“å‰è¿œå…‰ç¯çš„çŠ¶æ€
 347   2          }
 348   1      
 349   1          if (flag_get_engine_speed)
 350   1          {
 351   2              // å¦‚æœè¦è·å–å‘åŠ¨æœºçš„è½¬é€Ÿ
 352   2              flag_get_engine_speed = 0;
 353   2      #if USE_MY_DEBUG
                      // printf(" flag_get_engine_speed \n");
                      // printf(" cur engine speed %u rpm ", (u16)fun_info.engine_speeed);
              #endif
 357   2              send_data(SEND_ENGINE_SPEED, fun_info.engine_speeed); //
 358   2          }
 359   1      
 360   1          if (flag_get_speed)
 361   1          {
 362   2              // å¦‚æœè¦è·å–æ—¶é€Ÿ
 363   2              flag_get_speed = 0;
 364   2      #if USE_MY_DEBUG
                      // printf(" flag_get_speed \n");
              #endif
 367   2      
 368   2      #ifdef USE_INTERNATIONAL // ä½¿ç”¨å…¬åˆ¶å•ä½
 369   2      
 370   2              send_data(SEND_SPEED, fun_info.speed); // å‘é€å½“å‰é‡‡é›†åˆ°çš„è½¦é€Ÿï¼ˆæ—¶é€Ÿï¼‰
 371   2      
 372   2      #endif // USE_INTERNATIONAL ä½¿ç”¨å…¬åˆ¶å•ä½
 373   2      
 374   2      #ifdef USE_IMPERIAL // ä½¿ç”¨è‹±åˆ¶å•ä½
              
                      // 1km/h == 0.621427mile/h
                      send_data(SEND_SPEED, fun_info.speed * 621 / 1000);
              
              #endif
 380   2          }
 381   1      
 382   1          if (flag_get_fuel)
 383   1          {
 384   2              // å¦‚æœè¦è·å–æ²¹é‡
 385   2              flag_get_fuel = 0;
 386   2      
 387   2      #if USE_MY_DEBUG
                      // printf(" flag_get_fuel \n");
              #endif
 390   2      
 391   2              send_data(SEND_FUEL, fun_info.fuel);
 392   2          }
 393   1      
 394   1          // ä¸ç”¨å‘é€æ°´æ¸©ï¼Œæ”¹ä¸ºå‘é€æ°´æ¸©æŠ¥è­¦
 395   1          //     if (flag_get_temp_of_water)
 396   1          //     {
 397   1          //         // å¦‚æœè¦è·å–æ°´æ¸©
 398   1          //         flag_get_temp_of_water = 0;
 399   1          // #if USE_MY_DEBUG
 400   1          //         printf(" flag_get_temp_of_water \n");
 401   1          // #endif
 402   1          //         send_data(SEND_WATER_TEMP, fun_info.temp_of_water);
 403   1          //     }
 404   1      
 405   1          if (flag_update_malfunction_status) // æ›´æ–°æ•…éšœçš„çŠ¶æ€
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 8   

 406   1          {
 407   2              flag_update_malfunction_status = 0;
 408   2              send_data(SEND_MALFUNCTION_STATUS, fun_info.flag_is_detect_malfunction);
 409   2      
 410   2              // æ²¡æœ‰å¼•è„šæ£€æµ‹ABSï¼Œé‚£ä¹ˆæ£€æµ‹åˆ°æ•…éšœä¹‹åï¼Œä¹Ÿå‘é€ABSçš„çŠ¶æ€
 411   2              send_data(SEND_ABS_STATUS, fun_info.flag_is_detect_abs);
 412   2          }
 413   1      
 414   1          if (flag_get_total_mileage) // å¦‚æœè¦è·å–å¤§è®¡é‡Œç¨‹ / å¾—åˆ°äº†å¤§è®¡é‡Œç¨‹æ–°çš„æ•°æ®
 415   1          {
 416   2              flag_get_total_mileage = 0;
 417   2      #if USE_MY_DEBUG
                      // printf(" flag_get_total_mileage \n");
                      // printf(" cur total mileage %lu m \n", (u32)fun_info.save_info.total_mileage);
              #endif
 421   2      
 422   2      #ifdef USE_INTERNATIONAL // å…¬åˆ¶å•ä½
 423   2      
 424   2              // åªå‘é€åƒç±³åŠä»¥ä¸Šçš„æ•°æ®
 425   2              send_data(SEND_TOTAL_MILEAGE, fun_info.save_info.total_mileage / 1000);
 426   2      
 427   2      #endif // USE_INTERNATIONAL å…¬åˆ¶å•ä½
 428   2      
 429   2      #ifdef USE_IMPERIAL // è‹±åˆ¶å•ä½
              
              #if USE_MY_DEBUG
                      // printf(" flag_get_total_mileage \n");
                      // printf(" cur total mileage %lu mile \n", (u32)fun_info.save_info.total_mileage / 1610); // 1km 
             -== 0.621427mile
              #endif // USE_MY_DEBUG
              
                      // åªå‘é€1è‹±é‡ŒåŠä»¥ä¸Šçš„æ•°æ®
                      send_data(SEND_TOTAL_MILEAGE, fun_info.save_info.total_mileage / 1610); // 1km == 0.621427mile
              
              #endif // USE_IMPERIAL è‹±åˆ¶å•ä½
 440   2          } // if (flag_get_total_mileage) // å¦‚æœè¦è·å–å¤§è®¡é‡Œç¨‹ / å¾—åˆ°äº†å¤§è®¡é‡Œç¨‹æ–°çš„æ•°æ®
 441   1      
 442   1          if (flag_get_sub_total_mileage) // å¦‚æœè¦è·å–å°è®¡é‡Œç¨‹ / å¾—åˆ°äº†å°è®¡é‡Œç¨‹æ–°çš„æ•°æ®
 443   1          {
 444   2      
 445   2              flag_get_sub_total_mileage = 0;
 446   2      #if USE_MY_DEBUG
                      // printf(" flag_get_sub_total_mileage \n");
                      // printf(" cur subtotal mileage %lu m \n", (u32)fun_info.save_info.subtotal_mileage);
              #endif // USE_MY_DEBUG
 450   2      
 451   2      #ifdef USE_INTERNATIONAL // å…¬åˆ¶å•ä½
 452   2              // åªå‘é€ç™¾ç±³åŠä»¥ä¸Šçš„æ•°æ®
 453   2              send_data(SEND_SUBTOTAL_MILEAGE, fun_info.save_info.subtotal_mileage / 100);
 454   2      #endif // USE_INTERNATIONAL å…¬åˆ¶å•ä½
 455   2      
 456   2      #ifdef USE_IMPERIAL // è‹±åˆ¶å•ä½
              
              #if USE_MY_DEBUG
                      printf("sub total mileage: %lu * 0.1 mile \n", fun_info.save_info.subtotal_mileage / 161);
              #endif // USE_MY_DEBUG
                     // åªå‘é€0.1è‹±é‡ŒåŠä»¥ä¸Šçš„æ•°æ®
                     // å˜é‡ä¸­å­˜æ”¾çš„æ˜¯ä»¥mä¸ºå•ä½çš„æ•°æ®ï¼Œéœ€è¦åšè½¬æ¢å†å‘é€
                     // 1km == 0.621427mileï¼Œ1km == 6.21427 * 0.1 mile
                      send_data(SEND_SUBTOTAL_MILEAGE, fun_info.save_info.subtotal_mileage / 161);
              
              #endif // USE_IMPERIAL è‹±åˆ¶å•ä½
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 9   

 467   2          } //     if (flag_get_sub_total_mileage) // å¦‚æœè¦è·å–å°è®¡é‡Œç¨‹ / å¾—åˆ°äº†å°è®¡é‡Œç¨‹æ–°çš„æ
             -•°æ®
 468   1      
 469   1      #if 0 // ä¿®æ”¹æ—¥æœŸ
                  if (flag_alter_date)
                  {
                      // å¦‚æœè¦ä¿®æ”¹æ—¥æœŸ
                      flag_alter_date = 0;
              #if USE_MY_DEBUG
                      printf(" flag_alter_date \n");
                      printf("year %u month %bu day %bu \n", fun_info.aip1302_saveinfo.year, fun_info.aip1302_saveinfo.m
             -onth, fun_info.aip1302_saveinfo.day);
              #endif
              
                      if (update_date_status == UPDATE_STATUS_NONE)
                      {
              #if USE_MY_DEBUG
              // printf("handle update_date \n");
              #endif
                          // å¦‚æœæ›´æ–°æ—¥æœŸçš„çŠ¶æ€å·²ç»å†·å´å®Œæ¯•ï¼Œæ›´æ–°æ—¥æœŸï¼Œå¹¶ä¸”è¿›å…¥å†·å´çŠ¶æ€ï¼Œ
                          // åˆ‡æ¢çŠ¶æ€ï¼Œè®©å®šæ—¶å™¨è¿›è¡Œå†·å´è®¡æ—¶
                          aip1302_update_date(fun_info.aip1302_saveinfo); // å°†æ—¥æœŸæ›´æ–°åˆ°æ—¶é’Ÿic
                          update_date_status = UPDATE_STATUS_HANDLING;
                      }
                  }
              #endif // ä¿®æ”¹æ—¥æœŸ
 491   1      
 492   1          if (flag_alter_time)
 493   1          {
 494   2              // å¦‚æœè¦ä¿®æ”¹æ—¶é—´
 495   2              flag_alter_time = 0;
 496   2      
 497   2      #if USE_MY_DEBUG
                      printf(" flag_alter_time \n");
                      printf("hour %bu min %bu sec %bu \n", fun_info.aip1302_saveinfo.time_hour, fun_info.aip1302_savein
             -fo.time_min, fun_info.aip1302_saveinfo.time_sec);
              #endif
 501   2      
 502   2              if (update_time_status == UPDATE_STATUS_NONE)
 503   2              {
 504   3                  // printf("handle update_time \n");
 505   3                  // å¦‚æœæ›´æ–°æ—¶é—´çš„çŠ¶æ€å·²ç»å†·å´å®Œæ¯•ï¼Œæ›´æ–°æ—¶é—´ï¼Œå¹¶ä¸”è¿›å…¥å†·å´çŠ¶æ€ï¼Œ
 506   3                  // åˆ‡æ¢çŠ¶æ€ï¼Œè®©å®šæ—¶å™¨è¿›è¡Œå†·å´è®¡æ—¶
 507   3                  aip1302_update_time(fun_info.aip1302_saveinfo); // å°†æ—¶é—´æ›´æ–°åˆ°æ—¶é’Ÿic
 508   3                  update_time_status = UPDATE_STATUS_HANDLING;
 509   3              }
 510   2          }
 511   1      
 512   1          if (flag_get_voltage_of_battery)
 513   1          {
 514   2              // å¦‚æœè¦è·å–ç”µæ± ç”µå‹
 515   2              flag_get_voltage_of_battery = 0;
 516   2      #if USE_MY_DEBUG
                      // printf(" flag_get_voltage_of_battery \n");
                      // printf(" cur voltage of battery %u \n", (u16)fun_info.voltage_of_battery);
              #endif
 520   2              send_data(SEND_VOLTAGE_OF_BATTERY, fun_info.voltage_of_battery);
 521   2          }
 522   1      
 523   1          if (flag_set_temp_of_water_warning)
 524   1          {
 525   2              // å¦‚æœè¦è®¾ç½®æ°´æ¸©æŠ¥è­¦
C51 COMPILER V9.60.7.0   INSTRUCTION                                                       05/27/2025 16:56:45 PAGE 10  

 526   2              flag_set_temp_of_water_warning = 0;
 527   2      #if USE_MY_DEBUG
                      // printf(" flag_set_temp_of_water_warning \n");
              #endif
 530   2              //  å‘é€å½“å‰æ°´æ¸©æŠ¥è­¦çš„çŠ¶æ€
 531   2              send_data(SEND_TEMP_OF_WATER_ALERT, fun_info.flag_is_in_water_temp_warning);
 532   2          }
 533   1      
 534   1          if (flag_clear_total_mileage)
 535   1          {
 536   2              // å¦‚æœè¦æ¸…é™¤å¤§è®¡é‡Œç¨‹
 537   2              flag_clear_total_mileage = 0;
 538   2              fun_info.save_info.total_mileage = 0;
 539   2              distance = 0;    //
 540   2              fun_info_save(); // å°†ä¿¡æ¯å†™å›flash
 541   2      #if USE_MY_DEBUG
                      printf(" flag_clear_total_mileage \n");
              #endif
 544   2          }
 545   1      
 546   1          if (flag_clear_sub_total_mileage)
 547   1          {
 548   2              // å¦‚æœè¦æ¸…é™¤å°è®¡é‡Œç¨‹
 549   2              flag_clear_sub_total_mileage = 0;
 550   2              fun_info.save_info.subtotal_mileage = 0;
 551   2              distance = 0;
 552   2              fun_info_save(); // å°†ä¿¡æ¯å†™å›flash
 553   2      #if USE_MY_DEBUG
                      printf(" flag_clear_sub_total_mileage \n");
              #endif
 556   2          }
 557   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    896    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      9       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =     19    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
